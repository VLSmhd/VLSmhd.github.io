<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>leetcode-SQL专项训练 | VLS_Blog</title><meta name="author" content="Vlong_shen"><meta name="copyright" content="Vlong_shen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Mysql常见函数 mysql: 常用函数总结以及高级函数用法_mysql values函数-CSDN博客 字符串函数         函数 描述 实例     ASCII(s) 返回字符串 s 的第一个字符的 ASCII 码。 返回 CustomerName 字段第一个字母的 ASCII 码：SELECT ASCII(CustomerName) AS">
<meta property="og:type" content="article">
<meta property="og:title" content="leetcode-SQL专项训练">
<meta property="og:url" content="https://vlsmhd.github.io/2024/03/15/Leetcode-SQL%E4%B8%93%E9%A1%B9%E8%AE%AD%E7%BB%83/index.html">
<meta property="og:site_name" content="VLS_Blog">
<meta property="og:description" content="Mysql常见函数 mysql: 常用函数总结以及高级函数用法_mysql values函数-CSDN博客 字符串函数         函数 描述 实例     ASCII(s) 返回字符串 s 的第一个字符的 ASCII 码。 返回 CustomerName 字段第一个字母的 ASCII 码：SELECT ASCII(CustomerName) AS">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://vlsmhd.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2024-03-15T14:04:55.480Z">
<meta property="article:modified_time" content="2024-04-15T03:38:47.580Z">
<meta property="article:author" content="Vlong_shen">
<meta property="article:tag" content="learn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vlsmhd.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://vlsmhd.github.io/2024/03/15/Leetcode-SQL%E4%B8%93%E9%A1%B9%E8%AE%AD%E7%BB%83/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'leetcode-SQL专项训练',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-15 11:38:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="VLS_Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">117</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">83</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fas fa-images"></i><span> Photo</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="VLS_Blog"><img class="site-icon" src="https://vlsmhd.github.io/img/avatar.jpg"/><span class="site-name">VLS_Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fas fa-images"></i><span> Photo</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">leetcode-SQL专项训练</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-15T14:04:55.480Z" title="发表于 2024-03-15 22:04:55">2024-03-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-15T03:38:47.580Z" title="更新于 2024-04-15 11:38:47">2024-04-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/leetcode/">leetcode</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/leetcode/SQL/">SQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="leetcode-SQL专项训练"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="mysql常见函数">Mysql常见函数</h1>
<p><a
target="_blank" rel="noopener" href="https://blog.csdn.net/yubin1285570923/article/details/118560285">mysql:
常用函数总结以及高级函数用法_mysql values函数-CSDN博客</a></p>
<h2 id="字符串函数">字符串函数</h2>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 32%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ASCII(s)</td>
<td>返回字符串 s 的第一个字符的 ASCII 码。</td>
<td>返回 CustomerName 字段第一个字母的 ASCII
码：<code>SELECT ASCII(CustomerName) AS NumCodeOfFirstCharFROM Customers</code></td>
</tr>
<tr class="even">
<td>LENGTH</td>
<td>返回字符串 s 的字节数</td>
<td>LENGTH('¥')，返回两个字节</td>
</tr>
<tr class="odd">
<td>CHAR_LENGTH(s)</td>
<td>返回字符串 s 的字符数</td>
<td>返回字符串 RUNOOB
的字符数<code>SELECT CHAR_LENGTH("RUNOOB") AS LengthOfString</code></td>
</tr>
<tr class="even">
<td>CHARACTER_LENGTH(s)</td>
<td>返回字符串 s 的字符数</td>
<td>返回字符串 RUNOOB
的字符数<code>SELECT CHARACTER_LENGTH("RUNOOB") AS LengthOfString;</code></td>
</tr>
</tbody>
</table>
<h2 id="数值函数">数值函数</h2>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 32%" />
<col style="width: 58%" />
</colgroup>
<thead>
<tr class="header">
<th>函数名</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ABS(x)</td>
<td>返回 x 的绝对值</td>
<td>返回 -1 的绝对值：<code>SELECT ABS(-1) -- 返回1</code></td>
</tr>
<tr class="even">
<td>ACOS(x)</td>
<td>求 x 的反余弦值(参数是弧度)</td>
<td><code>SELECT ACOS(0.25);</code></td>
</tr>
<tr class="odd">
<td>ROUND(x,y)</td>
<td>返回离 y位数 最近的整数(四舍五入)</td>
<td>SELECT ROUND(1.23456) --1 ，不填y默认为0，就是四舍五入到整数</td>
</tr>
</tbody>
</table>
<h2 id="日期函数">日期函数</h2>
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 29%" />
<col style="width: 58%" />
</colgroup>
<thead>
<tr class="header">
<th>函数名</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ADDDATE(d,n)</td>
<td>计算起始日期 d 加上 n 天的日期</td>
<td><code>SELECT ADDDATE("2017-06-15", INTERVAL 10 DAY);-&gt;2017-06-25</code>
<code>SELECT ADDDATE("2017-06-15", 10)</code></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>SUBDATE(d,n)</td>
<td>日期 d 减去 n 天后的日期</td>
<td>SELECT SUBDATE('2011-11-11 11:11:11', 1)-&gt;2011-11-10 11:11:11
(默认是天)</td>
</tr>
</tbody>
</table>
<h2 id="高级函数">高级函数</h2>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 45%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="header">
<th>函数名</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIN(x)</td>
<td>返回 x 的二进制编码</td>
<td>15 的 2 进制编码:<code>SELECT BIN(15); -- 1111</code></td>
</tr>
<tr class="even">
<td>IFNULL(v1,v2)</td>
<td>如果 v1 的值不为 NULL，则返回 v1，否则返回 v2。</td>
<td>SELECT IFNULL(null,'Hello Word')-&gt;Hello Word</td>
</tr>
</tbody>
</table>
<h1 id="简单查询">简单查询</h1>
<h2 id="简单">简单</h2>
<h3 id="每台机器的进程平均运行时间"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/average-time-of-process-per-machine/">1661.
每台机器的进程平均运行时间</a></h3>
<p>表: <code>Activity</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| machine_id     | int     |</span><br><span class="line">| process_id     | int     |</span><br><span class="line">| activity_type  | enum    |</span><br><span class="line">| timestamp      | float   |</span><br><span class="line">+----------------+---------+</span><br><span class="line">该表展示了一家工厂网站的用户活动。</span><br><span class="line">(machine_id, process_id, activity_type) 是当前表的主键（具有唯一值的列的组合）。</span><br><span class="line">machine_id 是一台机器的ID号。</span><br><span class="line">process_id 是运行在各机器上的进程ID号。</span><br><span class="line">activity_type 是枚举类型 (&#x27;start&#x27;, &#x27;end&#x27;)。</span><br><span class="line">timestamp 是浮点类型,代表当前时间(以秒为单位)。</span><br><span class="line">&#x27;start&#x27; 代表该进程在这台机器上的开始运行时间戳 , &#x27;end&#x27; 代表该进程在这台机器上的终止运行时间戳。</span><br><span class="line">同一台机器，同一个进程都有一对开始时间戳和结束时间戳，而且开始时间戳永远在结束时间戳前面。</span><br></pre></td></tr></table></figure>
<p>现在有一个工厂网站由几台机器运行，每台机器上运行着
<strong>相同数量的进程</strong>
。编写解决方案，计算每台机器各自完成一个进程任务的平均耗时。</p>
<p>完成一个进程任务的时间指进程的<code>'end' 时间戳</code> 减去
<code>'start' 时间戳</code>。平均耗时通过计算每台机器上所有进程任务的总耗费时间除以机器上的总进程数量获得。</p>
<p>结果表必须包含<code>machine_id（机器ID）</code> 和对应的
<strong>average time（平均耗时）</strong> 别名
<code>processing_time</code>，且<strong>四舍五入保留3位小数。</strong></p>
<p>以 <strong>任意顺序</strong> 返回表。</p>
<p>具体参考例子如下。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Activity table:</span><br><span class="line">+------------+------------+---------------+-----------+</span><br><span class="line">| machine_id | process_id | activity_type | timestamp |</span><br><span class="line">+------------+------------+---------------+-----------+</span><br><span class="line">| 0          | 0          | start         | 0.712     |</span><br><span class="line">| 0          | 0          | end           | 1.520     |</span><br><span class="line">| 0          | 1          | start         | 3.140     |</span><br><span class="line">| 0          | 1          | end           | 4.120     |</span><br><span class="line">| 1          | 0          | start         | 0.550     |</span><br><span class="line">| 1          | 0          | end           | 1.550     |</span><br><span class="line">| 1          | 1          | start         | 0.430     |</span><br><span class="line">| 1          | 1          | end           | 1.420     |</span><br><span class="line">| 2          | 0          | start         | 4.100     |</span><br><span class="line">| 2          | 0          | end           | 4.512     |</span><br><span class="line">| 2          | 1          | start         | 2.500     |</span><br><span class="line">| 2          | 1          | end           | 5.000     |</span><br><span class="line">+------------+------------+---------------+-----------+</span><br><span class="line">输出：</span><br><span class="line">+------------+-----------------+</span><br><span class="line">| machine_id | processing_time |</span><br><span class="line">+------------+-----------------+</span><br><span class="line">| 0          | 0.894           |</span><br><span class="line">| 1          | 0.995           |</span><br><span class="line">| 2          | 1.456           |</span><br><span class="line">+------------+-----------------+</span><br><span class="line">解释：</span><br><span class="line">一共有3台机器,每台机器运行着两个进程.</span><br><span class="line">机器 0 的平均耗时: ((1.520 - 0.712) + (4.120 - 3.140)) / 2 = 0.894</span><br><span class="line">机器 1 的平均耗时: ((1.550 - 0.550) + (1.420 - 0.430)) / 2 = 0.995</span><br><span class="line">机器 2 的平均耗时: ((4.512 - 4.100) + (5.000 - 2.500)) / 2 = 1.456</span><br></pre></td></tr></table></figure>
<h4 id="思路">思路</h4>
<h5 id="拆分表">拆分表</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> a.machine_id, round(<span class="built_in">avg</span>(b.timestamp  <span class="operator">-</span> a.timestamp ), <span class="number">3</span>) processing_time </span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Activity <span class="keyword">where</span> activity_type <span class="operator">=</span> <span class="string">&#x27;start&#x27;</span> ) a,</span><br><span class="line"> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Activity <span class="keyword">where</span> activity_type <span class="operator">=</span> <span class="string">&#x27;end&#x27;</span> ) b </span><br><span class="line"><span class="keyword">where</span> a.machine_id <span class="operator">=</span> b.machine_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.machine_id</span><br></pre></td></tr></table></figure>
<h3 id="寻找用户推荐人"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-customer-referee/">584.
寻找用户推荐人</a></h3>
<p>表: <code>Customer</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| name        | varchar |</span><br><span class="line">| referee_id  | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">在 SQL 中，id 是该表的主键列。</span><br><span class="line">该表的每一行表示一个客户的 id、姓名以及推荐他们的客户的 id。</span><br></pre></td></tr></table></figure>
<p>找出那些 <strong>没有被</strong> <code>id = 2</code> 的客户
<strong>推荐</strong> 的客户的姓名。</p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>结果格式如下所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">输入： </span><br><span class="line">Customer 表:</span><br><span class="line">+----+------+------------+</span><br><span class="line">| id | name | referee_id |</span><br><span class="line">+----+------+------------+</span><br><span class="line">| 1  | Will | null       |</span><br><span class="line">| 2  | Jane | null       |</span><br><span class="line">| 3  | Alex | 2          |</span><br><span class="line">| 4  | Bill | null       |</span><br><span class="line">| 5  | Zack | 1          |</span><br><span class="line">| 6  | Mark | 2          |</span><br><span class="line">+----+------+------------+</span><br><span class="line">输出：</span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| Will |</span><br><span class="line">| Jane |</span><br><span class="line">| Bill |</span><br><span class="line">| Zack |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>
<h4 id="思路-1">思路</h4>
<h5 id="多条件">多条件</h5>
<p>本题单独的条件 referee_id ！= 2 无法得到referee_id
为空的结果，因此要多加一个判断条件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name </span><br><span class="line"><span class="keyword">from</span> Customer</span><br><span class="line"><span class="keyword">where</span> referee_id  <span class="operator">!=</span> <span class="number">2</span> <span class="keyword">or</span> referee_id <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>
<h5 id="in子表">in子表</h5>
<p>效率比思路一快，</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name </span><br><span class="line"><span class="keyword">FROM</span> Customer</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> Customer <span class="keyword">WHERE</span> referee_id <span class="operator">=</span> <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h5 id="exists">exists</h5>
<p>由于外表数据量不多，效率和in相差一点</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> C.name </span><br><span class="line"><span class="keyword">FROM</span> Customer C</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> C1.name <span class="keyword">FROM</span> Customer C1 <span class="keyword">WHERE</span> referee_id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> C.id <span class="operator">=</span> C1.id)</span><br></pre></td></tr></table></figure>
<h3 id="大的国家"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/big-countries/">595.
大的国家</a></h3>
<p><code>World</code> 表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| name        | varchar |</span><br><span class="line">| continent   | varchar |</span><br><span class="line">| area        | int     |</span><br><span class="line">| population  | int     |</span><br><span class="line">| gdp         | bigint  |</span><br><span class="line">+-------------+---------+</span><br><span class="line">name 是该表的主键（具有唯一值的列）。</span><br><span class="line">这张表的每一行提供：国家名称、所属大陆、面积、人口和 GDP 值。</span><br></pre></td></tr></table></figure>
<p>如果一个国家满足下述两个条件之一，则认为该国是 <strong>大国</strong>
：</p>
<ul>
<li>面积至少为 300 万平方公里（即，<code>3000000 km2</code>），或者</li>
<li>人口至少为 2500 万（即 <code>25000000</code>）</li>
</ul>
<p>编写解决方案找出 <strong>大国</strong> 的国家名称、人口和面积。</p>
<p>按 <strong>任意顺序</strong> 返回结果表。</p>
<p>返回结果格式如下例所示。</p>
<p><strong>示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">World 表：</span><br><span class="line">+-------------+-----------+---------+------------+--------------+</span><br><span class="line">| name        | continent | area    | population | gdp          |</span><br><span class="line">+-------------+-----------+---------+------------+--------------+</span><br><span class="line">| Afghanistan | Asia      | 652230  | 25500100   | 20343000000  |</span><br><span class="line">| Albania     | Europe    | 28748   | 2831741    | 12960000000  |</span><br><span class="line">| Algeria     | Africa    | 2381741 | 37100000   | 188681000000 |</span><br><span class="line">| Andorra     | Europe    | 468     | 78115      | 3712000000   |</span><br><span class="line">| Angola      | Africa    | 1246700 | 20609294   | 100990000000 |</span><br><span class="line">+-------------+-----------+---------+------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+-------------+------------+---------+</span><br><span class="line">| name        | population | area    |</span><br><span class="line">+-------------+------------+---------+</span><br><span class="line">| Afghanistan | 25500100   | 652230  |</span><br><span class="line">| Algeria     | 37100000   | 2381741 |</span><br><span class="line">+-------------+------------+---------+</span><br></pre></td></tr></table></figure>
<h4 id="思路-2">思路</h4>
<h5 id="or语句">or语句</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, population, area </span><br><span class="line"><span class="keyword">FROM</span>  World </span><br><span class="line"><span class="keyword">WHERE</span> area <span class="operator">&gt;=</span> <span class="number">3000000</span> <span class="keyword">or</span> population  <span class="operator">&gt;=</span> <span class="number">25000000</span></span><br></pre></td></tr></table></figure>
<p>or并不会走索引，所以采用union优化：</p>
<h5 id="union优化">union优化</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, population, area </span><br><span class="line"><span class="keyword">FROM</span>  World </span><br><span class="line"><span class="keyword">WHERE</span> area <span class="operator">&gt;=</span> <span class="number">3000000</span> </span><br><span class="line"><span class="keyword">union</span> </span><br><span class="line"><span class="keyword">SELECT</span> name, population, area </span><br><span class="line"><span class="keyword">FROM</span>  World </span><br><span class="line"><span class="keyword">WHERE</span> population  <span class="operator">&gt;=</span> <span class="number">25000000</span></span><br></pre></td></tr></table></figure>
<h3 id="文章浏览-i"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/article-views-i/">1148. 文章浏览
I</a></h3>
<p><code>Views</code> 表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| article_id    | int     |</span><br><span class="line">| author_id     | int     |</span><br><span class="line">| viewer_id     | int     |</span><br><span class="line">| view_date     | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">此表可能会存在重复行。（换句话说，在 SQL 中这个表没有主键）</span><br><span class="line">此表的每一行都表示某人在某天浏览了某位作者的某篇文章。</span><br><span class="line">请注意，同一人的 author_id 和 viewer_id 是相同的。</span><br></pre></td></tr></table></figure>
<p>请查询出所有浏览过自己文章的作者</p>
<p>结果按照 <code>id</code> 升序排列。</p>
<p>查询结果的格式如下所示：</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Views 表：</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| article_id | author_id | viewer_id | view_date  |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| 1          | 3         | 5         | 2019-08-01 |</span><br><span class="line">| 1          | 3         | 6         | 2019-08-02 |</span><br><span class="line">| 2          | 7         | 7         | 2019-08-01 |</span><br><span class="line">| 2          | 7         | 6         | 2019-08-02 |</span><br><span class="line">| 4          | 7         | 1         | 2019-07-22 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">| 4    |</span><br><span class="line">| 7    |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>
<h4 id="思路-3">思路</h4>
<p>去重利用关键字distinct去重</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">distinct</span> author_id <span class="keyword">as</span> id</span><br><span class="line"><span class="keyword">FROM</span> Views</span><br><span class="line"><span class="keyword">where</span> author_id <span class="operator">=</span> viewer_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>
<h3 id="无效的推文"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/invalid-tweets/">1683.
无效的推文</a></h3>
<p>表：<code>Tweets</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| tweet_id       | int     |</span><br><span class="line">| content        | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">在 SQL 中，tweet_id 是这个表的主键。</span><br><span class="line">这个表包含某社交媒体 App 中所有的推文。</span><br></pre></td></tr></table></figure>
<p>查询所有无效推文的编号（ID）。当推文内容中的字符数<strong>严格大于</strong>
<code>15</code> 时，该推文是无效的。</p>
<p>以<strong>任意顺序</strong>返回结果表。</p>
<p>查询结果格式如下所示：</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Tweets 表：</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| tweet_id | content                          |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| 1        | Vote for Biden                   |</span><br><span class="line">| 2        | Let us make America great again! |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">+----------+</span><br><span class="line">| tweet_id |</span><br><span class="line">+----------+</span><br><span class="line">| 2        |</span><br><span class="line">+----------+</span><br><span class="line">解释：</span><br><span class="line">推文 1 的长度 length = 14。该推文是有效的。</span><br><span class="line">推文 2 的长度 length = 32。该推文是无效的。</span><br></pre></td></tr></table></figure>
<h4 id="思路-4">思路</h4>
<h5 id="求长度函数">求长度函数</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tweet_id </span><br><span class="line"><span class="keyword">from</span>     Tweets </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">CHAR_LENGTH</span>(content) <span class="operator">&gt;</span> <span class="number">15</span></span><br></pre></td></tr></table></figure>
<h1 id="连接查询">连接查询</h1>
<h2 id="简单-1">简单</h2>
<h3 id="使用唯一标识码替换员工id"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/replace-employee-id-with-the-unique-identifier/">1378.
使用唯一标识码替换员工ID</a></h3>
<p><code>Employees</code> 表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，id 是这张表的主键。</span><br><span class="line">这张表的每一行分别代表了某公司其中一位员工的名字和 ID 。</span><br></pre></td></tr></table></figure>
<p><code>EmployeeUNI</code> 表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| unique_id     | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，(id, unique_id) 是这张表的主键。</span><br><span class="line">这张表的每一行包含了该公司某位员工的 ID 和他的唯一标识码（unique ID）。</span><br></pre></td></tr></table></figure>
<p>展示每位用户的 <strong>唯一标识码（unique ID
）</strong>；如果某位员工没有唯一标识码，使用 null 填充即可。</p>
<p>你可以以 <strong>任意</strong> 顺序返回结果表。</p>
<p>返回结果的格式如下例所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Employees 表:</span><br><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | Alice    |</span><br><span class="line">| 7  | Bob      |</span><br><span class="line">| 11 | Meir     |</span><br><span class="line">| 90 | Winston  |</span><br><span class="line">| 3  | Jonathan |</span><br><span class="line">+----+----------+</span><br><span class="line">EmployeeUNI 表:</span><br><span class="line">+----+-----------+</span><br><span class="line">| id | unique_id |</span><br><span class="line">+----+-----------+</span><br><span class="line">| 3  | 1         |</span><br><span class="line">| 11 | 2         |</span><br><span class="line">| 90 | 3         |</span><br><span class="line">+----+-----------+</span><br><span class="line">输出：</span><br><span class="line">+-----------+----------+</span><br><span class="line">| unique_id | name     |</span><br><span class="line">+-----------+----------+</span><br><span class="line">| null      | Alice    |</span><br><span class="line">| null      | Bob      |</span><br><span class="line">| 2         | Meir     |</span><br><span class="line">| 3         | Winston  |</span><br><span class="line">| 1         | Jonathan |</span><br><span class="line">+-----------+----------+</span><br><span class="line">解释：</span><br><span class="line">Alice and Bob 没有唯一标识码, 因此我们使用 null 替代。</span><br><span class="line">Meir 的唯一标识码是 2 。</span><br><span class="line">Winston 的唯一标识码是 3 。</span><br><span class="line">Jonathan 唯一标识码是 1 。</span><br></pre></td></tr></table></figure>
<h4 id="思路-5">思路</h4>
<p>本题要展示全部的name，那就是要把第一个表的全部数据一个不落的查出来，这时候采用left
join 或者 right join比较合适。</p>
<h5 id="left-join">left join</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> b.unique_id, a.name</span><br><span class="line"><span class="keyword">from</span> Employees a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> EmployeeUNI b <span class="keyword">on</span> a.id <span class="operator">=</span> b.id</span><br></pre></td></tr></table></figure>
<p>ON 和 WHERE 在 SQL
中都用于设置条件，但它们在连接（JOIN）操作中的作用是不同的。</p>
<ol type="1">
<li>ON：在 JOIN 操作中，ON
关键字用于设置连接条件。例如，在你的查询中，ON
Employees.id=EmployeeUNI.id 是连接 Employees 表和 EmployeeUNI
表的条件，即只有当两个表中的 id
相等时，才会将这两个表的行连接在一起。</li>
<li>WHERE：WHERE
关键字用于过滤结果集，即只返回满足特定条件的行。如果你在查询中使用 WHERE
Employees.id=EmployeeUNI.id，那么只有当 Employees 表和 EmployeeUNI
表中的 id 相等时，才会在结果集中返回这些行。</li>
</ol>
<p>ON 关键字定义了如何连接两个表，而 WHERE
关键字定义了如何<strong>过滤</strong>这些连接后的结果。在某些情况下，使用
ON 和 WHERE
可能会得到相同的结果，但在其他情况下，结果可能会有所不同，特别是在执行外连接（如
LEFT JOIN 或 RIGHT JOIN）时。</p>
<ul>
<li>内连接（INNER JOIN）只返回两个表中都有匹配的行。</li>
<li>左连接（LEFT JOIN）返回左表（这里是 Employees
表）的所有行，如果右表（这里是 EmployeeUNI
表）中没有匹配的行，则结果集中的对应列将为 NULL。</li>
<li>WHERE 子句返回满足特定条件的行，这里的条件是 Employees.id 等于
EmployeeUNI.id。</li>
</ul>
<h3 id="产品销售分析-i"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/product-sales-analysis-i/">1068.
产品销售分析 I</a></h3>
<p>销售表 <code>Sales</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| sale_id     | int   |</span><br><span class="line">| product_id  | int   |</span><br><span class="line">| year        | int   |</span><br><span class="line">| quantity    | int   |</span><br><span class="line">| price       | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">(sale_id, year) 是销售表 Sales 的主键（具有唯一值的列的组合）。</span><br><span class="line">product_id 是关联到产品表 Product 的外键（reference 列）。</span><br><span class="line">该表的每一行显示 product_id 在某一年的销售情况。</span><br><span class="line">注意: price 表示每单位价格。</span><br></pre></td></tr></table></figure>
<p>产品表 <code>Product</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id 是表的主键（具有唯一值的列）。</span><br><span class="line">该表的每一行表示每种产品的产品名称。</span><br></pre></td></tr></table></figure>
<p>编写解决方案，以获取 <code>Sales</code> 表中所有 <code>sale_id</code>
对应的 <code>product_name</code> 以及该产品的所有 <code>year</code> 和
<code>price</code> 。</p>
<p>返回结果表 <strong>无顺序要求</strong> 。</p>
<p>结果格式示例如下。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Sales 表：</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">| sale_id | product_id | year | quantity | price |</span><br><span class="line">+---------+------------+------+----------+-------+ </span><br><span class="line">| 1       | 100        | 2008 | 10       | 5000  |</span><br><span class="line">| 2       | 100        | 2009 | 12       | 5000  |</span><br><span class="line">| 7       | 200        | 2011 | 15       | 9000  |</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">Product 表：</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 100        | Nokia        |</span><br><span class="line">| 200        | Apple        |</span><br><span class="line">| 300        | Samsung      |</span><br><span class="line">+------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+--------------+-------+-------+</span><br><span class="line">| product_name | year  | price |</span><br><span class="line">+--------------+-------+-------+</span><br><span class="line">| Nokia        | 2008  | 5000  |</span><br><span class="line">| Nokia        | 2009  | 5000  |</span><br><span class="line">| Apple        | 2011  | 9000  |</span><br><span class="line">+--------------+-------+-------+</span><br></pre></td></tr></table></figure>
<h4 id="思路-6">思路</h4>
<p>普通连接查询即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> b.product_name, a.year, a.price </span><br><span class="line"><span class="keyword">from</span> Sales a </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Product b <span class="keyword">on</span> a.product_id <span class="operator">=</span> b.product_id</span><br></pre></td></tr></table></figure>
<h3 id="进店却未进行过交易的顾客"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/customer-who-visited-but-did-not-make-any-transactions/">1581.
进店却未进行过交易的顾客</a></h3>
<p>表：<code>Visits</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| visit_id    | int     |</span><br><span class="line">| customer_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">visit_id 是该表中具有唯一值的列。</span><br><span class="line">该表包含有关光临过购物中心的顾客的信息。</span><br></pre></td></tr></table></figure>
<p>表：<code>Transactions</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| transaction_id | int     |</span><br><span class="line">| visit_id       | int     |</span><br><span class="line">| amount         | int     |</span><br><span class="line">+----------------+---------+</span><br><span class="line">transaction_id 是该表中具有唯一值的列。</span><br><span class="line">此表包含 visit_id 期间进行的交易的信息。</span><br></pre></td></tr></table></figure>
<p>有一些顾客可能光顾了购物中心但没有进行交易。请你编写一个解决方案，来查找这些顾客的
ID ，以及他们只光顾不交易的次数。</p>
<p>返回以 <strong>任何顺序</strong> 排序的结果表。</p>
<p>返回结果格式如下例所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">输入:</span><br><span class="line">Visits</span><br><span class="line">+----------+-------------+</span><br><span class="line">| visit_id | customer_id |</span><br><span class="line">+----------+-------------+</span><br><span class="line">| 1        | 23          |</span><br><span class="line">| 2        | 9           |</span><br><span class="line">| 4        | 30          |</span><br><span class="line">| 5        | 54          |</span><br><span class="line">| 6        | 96          |</span><br><span class="line">| 7        | 54          |</span><br><span class="line">| 8        | 54          |</span><br><span class="line">+----------+-------------+</span><br><span class="line">Transactions</span><br><span class="line">+----------------+----------+--------+</span><br><span class="line">| transaction_id | visit_id | amount |</span><br><span class="line">+----------------+----------+--------+</span><br><span class="line">| 2              | 5        | 310    |</span><br><span class="line">| 3              | 5        | 300    |</span><br><span class="line">| 9              | 5        | 200    |</span><br><span class="line">| 12             | 1        | 910    |</span><br><span class="line">| 13             | 2        | 970    |</span><br><span class="line">+----------------+----------+--------+</span><br><span class="line">输出:</span><br><span class="line">+-------------+----------------+</span><br><span class="line">| customer_id | count_no_trans |</span><br><span class="line">+-------------+----------------+</span><br><span class="line">| 54          | 2              |</span><br><span class="line">| 30          | 1              |</span><br><span class="line">| 96          | 1              |</span><br><span class="line">+-------------+----------------+</span><br><span class="line">解释:</span><br><span class="line">ID = 23 的顾客曾经逛过一次购物中心，并在 ID = 12 的访问期间进行了一笔交易。</span><br><span class="line">ID = 9 的顾客曾经逛过一次购物中心，并在 ID = 13 的访问期间进行了一笔交易。</span><br><span class="line">ID = 30 的顾客曾经去过购物中心，并且没有进行任何交易。</span><br><span class="line">ID = 54 的顾客三度造访了购物中心。在 2 次访问中，他们没有进行任何交易，在 1 次访问中，他们进行了 3 次交易。</span><br><span class="line">ID = 96 的顾客曾经去过购物中心，并且没有进行任何交易。</span><br><span class="line">如我们所见，ID 为 30 和 96 的顾客一次没有进行任何交易就去了购物中心。顾客 54 也两次访问了购物中心并且没有进行任何交易。</span><br></pre></td></tr></table></figure>
<h4 id="思路-7">思路</h4>
<h5 id="连接表查询">连接表查询</h5>
<p>进行连表查询的时候，先根据连表的结果，判断后续的一个条件。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customer_id , <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> count_no_trans</span><br><span class="line"><span class="keyword">from</span> Visits v</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Transactions t <span class="keyword">on</span> v.visit_id <span class="operator">=</span> t.visit_id</span><br><span class="line"><span class="keyword">where</span> t.transaction_id <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> v.customer_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> count_no_trans <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>
<h3 id="学生们参加各科测试的次数"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/students-and-examinations/">1280.
学生们参加各科测试的次数</a></h3>
<p>学生表: <code>Students</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| student_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，主键为 student_id（学生ID）。</span><br><span class="line">该表内的每一行都记录有学校一名学生的信息。</span><br></pre></td></tr></table></figure>
<p>科目表: <code>Subjects</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">在 SQL 中，主键为 subject_name（科目名称）。</span><br><span class="line">每一行记录学校的一门科目名称。</span><br></pre></td></tr></table></figure>
<p>考试表: <code>Examinations</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| student_id   | int     |</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">这个表可能包含重复数据（换句话说，在 SQL 中，这个表没有主键）。</span><br><span class="line">学生表里的一个学生修读科目表里的每一门科目。</span><br><span class="line">这张考试表的每一行记录就表示学生表里的某个学生参加了一次科目表里某门科目的测试。</span><br></pre></td></tr></table></figure>
<p>查询出每个学生参加每一门科目测试的次数，结果按
<code>student_id</code> 和 <code>subject_name</code> 排序。</p>
<p>查询结构格式如下所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Students table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| student_id | student_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 1          | Alice        |</span><br><span class="line">| 2          | Bob          |</span><br><span class="line">| 13         | John         |</span><br><span class="line">| 6          | Alex         |</span><br><span class="line">+------------+--------------+</span><br><span class="line">Subjects table:</span><br><span class="line">+--------------+</span><br><span class="line">| subject_name |</span><br><span class="line">+--------------+</span><br><span class="line">| Math         |</span><br><span class="line">| Physics      |</span><br><span class="line">| Programming  |</span><br><span class="line">+--------------+</span><br><span class="line">Examinations table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| student_id | subject_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 1          | Math         |</span><br><span class="line">| 1          | Physics      |</span><br><span class="line">| 1          | Programming  |</span><br><span class="line">| 2          | Programming  |</span><br><span class="line">| 1          | Physics      |</span><br><span class="line">| 1          | Math         |</span><br><span class="line">| 13         | Math         |</span><br><span class="line">| 13         | Programming  |</span><br><span class="line">| 13         | Physics      |</span><br><span class="line">| 2          | Math         |</span><br><span class="line">| 1          | Math         |</span><br><span class="line">+------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+--------------+--------------+----------------+</span><br><span class="line">| student_id | student_name | subject_name | attended_exams |</span><br><span class="line">+------------+--------------+--------------+----------------+</span><br><span class="line">| 1          | Alice        | Math         | 3              |</span><br><span class="line">| 1          | Alice        | Physics      | 2              |</span><br><span class="line">| 1          | Alice        | Programming  | 1              |</span><br><span class="line">| 2          | Bob          | Math         | 1              |</span><br><span class="line">| 2          | Bob          | Physics      | 0              |</span><br><span class="line">| 2          | Bob          | Programming  | 1              |</span><br><span class="line">| 6          | Alex         | Math         | 0              |</span><br><span class="line">| 6          | Alex         | Physics      | 0              |</span><br><span class="line">| 6          | Alex         | Programming  | 0              |</span><br><span class="line">| 13         | John         | Math         | 1              |</span><br><span class="line">| 13         | John         | Physics      | 1              |</span><br><span class="line">| 13         | John         | Programming  | 1              |</span><br><span class="line">+------------+--------------+--------------+----------------+</span><br><span class="line">解释：</span><br><span class="line">结果表需包含所有学生和所有科目（即便测试次数为0）：</span><br><span class="line">Alice 参加了 3 次数学测试, 2 次物理测试，以及 1 次编程测试；</span><br><span class="line">Bob 参加了 1 次数学测试, 1 次编程测试，没有参加物理测试；</span><br><span class="line">Alex 啥测试都没参加；</span><br><span class="line">John  参加了数学、物理、编程测试各 1 次。</span><br></pre></td></tr></table></figure>
<h4 id="思路-8">思路</h4>
<h5 id="多级连接">多级连接</h5>
<p>先让学生表和课程表笛卡尔积，</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    student_id, subject_name, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> attended_exams</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">    Examinations</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> </span><br><span class="line">    student_id, subject_name</span><br><span class="line"></span><br><span class="line">student_id	subject_name	attended_exams</span><br><span class="line"><span class="number">1</span>			Math				<span class="number">3</span></span><br><span class="line"><span class="number">1</span>			Physics				<span class="number">2</span></span><br><span class="line"><span class="number">1</span>			Programming			<span class="number">1</span></span><br><span class="line"><span class="number">2</span>			Programming			<span class="number">1</span></span><br><span class="line"><span class="number">13</span>			Math				<span class="number">1</span></span><br><span class="line"><span class="number">13</span>			Programming			<span class="number">1</span></span><br><span class="line"><span class="number">13</span>			Physics				<span class="number">1</span></span><br><span class="line"><span class="number">2</span>			Math				<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>随后将这个表与考试表查出来含有考试次数的结果集连接在一起</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.student_id, s.student_name, sub.subject_name, IFNULL(g.attended_exams, <span class="number">0</span>) <span class="keyword">AS</span> attended_exams</span><br><span class="line"><span class="keyword">from</span> Students s</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Subjects sub</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> e.student_id, e.subject_name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> attended_exams</span><br><span class="line"><span class="keyword">from</span> Examinations e</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.student_id, e.subject_name) g</span><br><span class="line"><span class="keyword">on</span> s.student_id <span class="operator">=</span> g.student_id <span class="keyword">and</span> sub.subject_name <span class="operator">=</span> g.subject_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> s.student_id, sub.subject_name <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>
<h1 id="聚合函数">聚合函数</h1>
<h2 id="简单-2">简单</h2>
<h3 id="平均售价"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/average-selling-price/">1251.
平均售价</a></h3>
<p>表：<code>Prices</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| start_date    | date    |</span><br><span class="line">| end_date      | date    |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(product_id，start_date，end_date) 是 prices 表的主键（具有唯一值的列的组合）。</span><br><span class="line">prices 表的每一行表示的是某个产品在一段时期内的价格。</span><br><span class="line">每个产品的对应时间段是不会重叠的，这也意味着同一个产品的价格时段不会出现交叉。</span><br></pre></td></tr></table></figure>
<p>表：<code>UnitsSold</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| purchase_date | date    |</span><br><span class="line">| units         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">该表可能包含重复数据。</span><br><span class="line">该表的每一行表示的是每种产品的出售日期，单位和产品 id。</span><br></pre></td></tr></table></figure>
<p>编写解决方案以查找每种产品的平均售价。<code>average_price</code> 应该
<strong>四舍五入到小数点后两位</strong>。</p>
<p>返回结果表 <strong>无顺序要求</strong> 。</p>
<p>结果格式如下例所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Prices table:</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">| product_id | start_date | end_date   | price  |</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">| 1          | 2019-02-17 | 2019-02-28 | 5      |</span><br><span class="line">| 1          | 2019-03-01 | 2019-03-22 | 20     |</span><br><span class="line">| 2          | 2019-02-01 | 2019-02-20 | 15     |</span><br><span class="line">| 2          | 2019-02-21 | 2019-03-31 | 30     |</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">UnitsSold table:</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">| product_id | purchase_date | units |</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">| 1          | 2019-02-25    | 100   |</span><br><span class="line">| 1          | 2019-03-01    | 15    |</span><br><span class="line">| 2          | 2019-02-10    | 200   |</span><br><span class="line">| 2          | 2019-03-22    | 30    |</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">输出：</span><br><span class="line">+------------+---------------+</span><br><span class="line">| product_id | average_price |</span><br><span class="line">+------------+---------------+</span><br><span class="line">| 1          | 6.96          |</span><br><span class="line">| 2          | 16.96         |</span><br><span class="line">+------------+---------------+</span><br><span class="line">解释：</span><br><span class="line">平均售价 = 产品总价 / 销售的产品数量。</span><br><span class="line">产品 1 的平均售价 = ((100 * 5)+(15 * 20) )/ 115 = 6.96</span><br><span class="line">产品 2 的平均售价 = ((200 * 15)+(30 * 30) )/ 230 = 16.96</span><br></pre></td></tr></table></figure>
<h4 id="思路-9">思路</h4>
<h5 id="子查询-连表">子查询 + 连表</h5>
<p>连表：</p>
<p>查出来总的销售额</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.product_id, p.price <span class="operator">*</span> u.units <span class="keyword">as</span> sales, u.units</span><br><span class="line"><span class="keyword">from</span> Prices p </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> UnitsSold u <span class="keyword">on</span> p.product_id <span class="operator">=</span> u.product_id</span><br><span class="line"><span class="keyword">and</span> u.purchase_date <span class="keyword">between</span> p.start_date <span class="keyword">and</span> p.end_date</span><br></pre></td></tr></table></figure>
<p>最终SUM聚合一下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sale.product_id, IFNULL(ROUND(<span class="built_in">SUM</span>(sales) <span class="operator">/</span> <span class="built_in">SUM</span>(units), <span class="number">2</span>), <span class="number">0</span>) <span class="keyword">as</span> average_price</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> p.product_id, p.price <span class="operator">*</span> u.units <span class="keyword">as</span> sales, u.units</span><br><span class="line"><span class="keyword">from</span> Prices p </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> UnitsSold u <span class="keyword">on</span> p.product_id <span class="operator">=</span> u.product_id</span><br><span class="line"><span class="keyword">and</span> u.purchase_date <span class="keyword">between</span> p.start_date <span class="keyword">and</span> p.end_date) <span class="keyword">as</span> sale</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> sale.product_id;</span><br></pre></td></tr></table></figure>
<h3 id="各赛事的用户注册率"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/percentage-of-users-attended-a-contest/">1633.
各赛事的用户注册率</a></h3>
<p>用户表： <code>Users</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| user_id     | int     |</span><br><span class="line">| user_name   | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">user_id 是该表的主键(具有唯一值的列)。</span><br><span class="line">该表中的每行包括用户 ID 和用户名。</span><br></pre></td></tr></table></figure>
<p>注册表： <code>Register</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| contest_id  | int     |</span><br><span class="line">| user_id     | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(contest_id, user_id) 是该表的主键(具有唯一值的列的组合)。</span><br><span class="line">该表中的每行包含用户的 ID 和他们注册的赛事。</span><br></pre></td></tr></table></figure>
<p>编写解决方案统计出各赛事的用户注册百分率，保留两位小数。</p>
<p>返回的结果表按 <code>percentage</code> 的 <strong>降序</strong>
排序，若相同则按 <code>contest_id</code> 的 <strong>升序</strong>
排序。</p>
<p>返回结果如下示例所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Users 表：</span><br><span class="line">+---------+-----------+</span><br><span class="line">| user_id | user_name |</span><br><span class="line">+---------+-----------+</span><br><span class="line">| 6       | Alice     |</span><br><span class="line">| 2       | Bob       |</span><br><span class="line">| 7       | Alex      |</span><br><span class="line">+---------+-----------+</span><br><span class="line"></span><br><span class="line">Register 表：</span><br><span class="line">+------------+---------+</span><br><span class="line">| contest_id | user_id |</span><br><span class="line">+------------+---------+</span><br><span class="line">| 215        | 6       |</span><br><span class="line">| 209        | 2       |</span><br><span class="line">| 208        | 2       |</span><br><span class="line">| 210        | 6       |</span><br><span class="line">| 208        | 6       |</span><br><span class="line">| 209        | 7       |</span><br><span class="line">| 209        | 6       |</span><br><span class="line">| 215        | 7       |</span><br><span class="line">| 208        | 7       |</span><br><span class="line">| 210        | 2       |</span><br><span class="line">| 207        | 2       |</span><br><span class="line">| 210        | 7       |</span><br><span class="line">+------------+---------+</span><br><span class="line">输出：</span><br><span class="line">+------------+------------+</span><br><span class="line">| contest_id | percentage |</span><br><span class="line">+------------+------------+</span><br><span class="line">| 208        | 100.0      |</span><br><span class="line">| 209        | 100.0      |</span><br><span class="line">| 210        | 100.0      |</span><br><span class="line">| 215        | 66.67      |</span><br><span class="line">| 207        | 33.33      |</span><br><span class="line">+------------+------------+</span><br><span class="line">解释：</span><br><span class="line">所有用户都注册了 208、209 和 210 赛事，因此这些赛事的注册率为 100% ，我们按 contest_id 的降序排序加入结果表中。</span><br><span class="line">Alice 和 Alex 注册了 215 赛事，注册率为 ((2/3) * 100) = 66.67%</span><br><span class="line">Bob 注册了 207 赛事，注册率为 ((1/3) * 100) = 33.33%</span><br></pre></td></tr></table></figure>
<h4 id="思路-10">思路</h4>
<h5 id="连接-聚合">连接 + 聚合</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> r.contest_id, round(<span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">/</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> Users)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>)  <span class="keyword">as</span> percentage </span><br><span class="line"><span class="keyword">from</span>  Register r</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> r.contest_id </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> percentage <span class="keyword">DESC</span>, r.contest_id <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>
<h3 id="查询结果的质量和占比"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/queries-quality-and-percentage/">1211.
查询结果的质量和占比</a></h3>
<p><code>Queries</code> 表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| query_name  | varchar |</span><br><span class="line">| result      | varchar |</span><br><span class="line">| position    | int     |</span><br><span class="line">| rating      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">此表可能有重复的行。</span><br><span class="line">此表包含了一些从数据库中收集的查询信息。</span><br><span class="line">“位置”（position）列的值为 1 到 500 。</span><br><span class="line">“评分”（rating）列的值为 1 到 5 。评分小于 3 的查询被定义为质量很差的查询。</span><br></pre></td></tr></table></figure>
<p>将查询结果的质量 <code>quality</code> 定义为：</p>
<blockquote>
<p>各查询结果的评分与其位置之间比率的平均值。</p>
</blockquote>
<p>将劣质查询百分比 <code>poor_query_percentage</code> 为：</p>
<blockquote>
<p>评分小于 3 的查询结果占全部查询结果的百分比。</p>
</blockquote>
<p>编写解决方案，找出每次的 <code>query_name</code> 、
<code>quality</code> 和 <code>poor_query_percentage</code>。</p>
<p><code>quality</code> 和 <code>poor_query_percentage</code> 都应
<strong>四舍五入到小数点后两位</strong> 。</p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>结果格式如下所示：</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Queries table:</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">| query_name | result            | position | rating |</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">| Dog        | Golden Retriever  | 1        | 5      |</span><br><span class="line">| Dog        | German Shepherd   | 2        | 5      |</span><br><span class="line">| Dog        | Mule              | 200      | 1      |</span><br><span class="line">| Cat        | Shirazi           | 5        | 2      |</span><br><span class="line">| Cat        | Siamese           | 3        | 3      |</span><br><span class="line">| Cat        | Sphynx            | 7        | 4      |</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">输出：</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">| query_name | quality | poor_query_percentage |</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">| Dog        | 2.50    | 33.33                 |</span><br><span class="line">| Cat        | 0.66    | 33.33                 |</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">解释：</span><br><span class="line">Dog 查询结果的质量为 ((5 / 1) + (5 / 2) + (1 / 200)) / 3 = 2.50</span><br><span class="line">Dog 查询结果的劣质查询百分比为 (1 / 3) * 100 = 33.33</span><br><span class="line"></span><br><span class="line">Cat 查询结果的质量为 ((2 / 5) + (3 / 3) + (4 / 7)) / 3 = 0.66</span><br><span class="line">Cat 查询结果的劣质查询百分比为 (1 / 3) * 100 = 33.33</span><br></pre></td></tr></table></figure>
<h4 id="思路-11">思路</h4>
<h5 id="count-if">count + if</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> query_name, Round(<span class="built_in">avg</span>(rating <span class="operator">/</span> position), <span class="number">2</span>) <span class="keyword">as</span> quality, ROUND(<span class="number">100</span> <span class="operator">*</span> <span class="built_in">count</span>(IF(rating <span class="operator">&lt;</span> <span class="number">3</span>, <span class="number">1</span>, <span class="keyword">null</span>)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>), <span class="number">2</span>) <span class="keyword">AS</span> poor_query_percentage</span><br><span class="line"><span class="keyword">from</span> Queries</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> query_name </span><br><span class="line"><span class="keyword">having</span> query_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>
<h2 id="中等">中等</h2>
<h3 id="每月交易-i"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/monthly-transactions-i/">1193.
每月交易 I</a></h3>
<p>表：<code>Transactions</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| country       | varchar |</span><br><span class="line">| state         | enum    |</span><br><span class="line">| amount        | int     |</span><br><span class="line">| trans_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id 是这个表的主键。</span><br><span class="line">该表包含有关传入事务的信息。</span><br><span class="line">state 列类型为 [&quot;approved&quot;, &quot;declined&quot;] 之一。</span><br></pre></td></tr></table></figure>
<p>编写一个 sql
查询来查找每个月和每个国家/地区的事务数及其总金额、已批准的事务数及其总金额。</p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>查询结果格式如下所示。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Transactions table:</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| id   | country | state    | amount | trans_date |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| 121  | US      | approved | 1000   | 2018-12-18 |</span><br><span class="line">| 122  | US      | declined | 2000   | 2018-12-19 |</span><br><span class="line">| 123  | US      | approved | 2000   | 2019-01-01 |</span><br><span class="line">| 124  | DE      | approved | 2000   | 2019-01-07 |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">输出：</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br><span class="line">| month    | country | trans_count | approved_count | trans_total_amount | approved_total_amount |</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br><span class="line">| 2018-12  | US      | 2           | 1              | 3000               | 1000                  |</span><br><span class="line">| 2019-01  | US      | 1           | 1              | 2000               | 2000                  |</span><br><span class="line">| 2019-01  | DE      | 1           | 1              | 2000               | 2000                  |</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br></pre></td></tr></table></figure>
<h4 id="思路-12">思路</h4>
<h5 id="多聚合函数">多聚合函数</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> DATE_FORMAT(trans_date, <span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">as</span> <span class="keyword">month</span>, country</span><br><span class="line">, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> trans_count</span><br><span class="line">, <span class="built_in">count</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, <span class="number">1</span>, <span class="keyword">null</span>)) <span class="keyword">as</span> approved_count </span><br><span class="line">, <span class="built_in">sum</span>(amount) <span class="keyword">AS</span> trans_total_amount </span><br><span class="line">, <span class="built_in">sum</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, amount, <span class="number">0</span>)) <span class="keyword">as</span> approved_total_amount </span><br><span class="line"><span class="keyword">from</span> Transactions</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">month</span>, country</span><br></pre></td></tr></table></figure>
<ul>
<li>注意日期格式</li>
<li>聚合函数配合IF条件进行筛选</li>
</ul>
<h3 id="即时食物配送-ii"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/immediate-food-delivery-ii/">1174.
即时食物配送 II</a></h3>
<p>配送表: <code>Delivery</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------+---------+</span><br><span class="line">| Column Name                 | Type    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| delivery_id                 | int     |</span><br><span class="line">| customer_id                 | int     |</span><br><span class="line">| order_date                  | date    |</span><br><span class="line">| customer_pref_delivery_date | date    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">delivery_id 是该表中具有唯一值的列。</span><br><span class="line">该表保存着顾客的食物配送信息，顾客在某个日期下了订单，并指定了一个期望的配送日期（和下单日期相同或者在那之后）。</span><br></pre></td></tr></table></figure>
<p>如果顾客期望的配送日期和下单日期相同，则该订单称为
「<strong>即时订单</strong>」，否则称为「<strong>计划订单</strong>」。</p>
<p>「<strong>首次订单</strong>」是顾客最早创建的订单。我们保证一个顾客只会有一个「首次订单」。</p>
<p>编写解决方案以获取即时订单在所有用户的首次订单中的比例。<strong>保留两位小数。</strong></p>
<p>结果示例如下所示：</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Delivery 表：</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| delivery_id | customer_id | order_date | customer_pref_delivery_date |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| 1           | 1           | 2019-08-01 | 2019-08-02                  |</span><br><span class="line">| 2           | 2           | 2019-08-02 | 2019-08-02                  |</span><br><span class="line">| 3           | 1           | 2019-08-11 | 2019-08-12                  |</span><br><span class="line">| 4           | 3           | 2019-08-24 | 2019-08-24                  |</span><br><span class="line">| 5           | 3           | 2019-08-21 | 2019-08-22                  |</span><br><span class="line">| 6           | 2           | 2019-08-11 | 2019-08-13                  |</span><br><span class="line">| 7           | 4           | 2019-08-09 | 2019-08-09                  |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">输出：</span><br><span class="line">+----------------------+</span><br><span class="line">| immediate_percentage |</span><br><span class="line">+----------------------+</span><br><span class="line">| 50.00                |</span><br><span class="line">+----------------------+</span><br><span class="line">解释：</span><br><span class="line">1 号顾客的 1 号订单是首次订单，并且是计划订单。</span><br><span class="line">2 号顾客的 2 号订单是首次订单，并且是即时订单。</span><br><span class="line">3 号顾客的 5 号订单是首次订单，并且是计划订单。</span><br><span class="line">4 号顾客的 7 号订单是首次订单，并且是即时订单。</span><br><span class="line">因此，一半顾客的首次订单是即时的。</span><br></pre></td></tr></table></figure>
<h4 id="思路-13">思路</h4>
<h5 id="where子查询-聚合函数">where子查询 + 聚合函数</h5>
<p>先查出子表：所有的首次订单</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(order_date), customer_id </span><br><span class="line"><span class="keyword">from</span> Delivery </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_id </span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> <span class="built_in">min</span>(order_date) <span class="operator">|</span> customer_id <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="comment">--------------- | ----------- |</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-08</span><span class="number">-01</span>      <span class="operator">|</span> <span class="number">1</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-08</span><span class="number">-02</span>      <span class="operator">|</span> <span class="number">2</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-08</span><span class="number">-21</span>      <span class="operator">|</span> <span class="number">3</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-08</span><span class="number">-09</span>      <span class="operator">|</span> <span class="number">4</span>           <span class="operator">|</span></span><br></pre></td></tr></table></figure>
<p>聚合函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Round(<span class="built_in">sum</span>(order_date <span class="operator">=</span> customer_pref_delivery_date)<span class="operator">*</span><span class="number">100</span> <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>), <span class="number">2</span>) <span class="keyword">as</span> immediate_percentage </span><br><span class="line"><span class="keyword">from</span> Delivery</span><br><span class="line"><span class="keyword">where</span> (order_date,customer_id) <span class="keyword">in</span></span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">min</span>(order_date), customer_id </span><br><span class="line"><span class="keyword">from</span> Delivery </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_id )</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="游戏玩法分析-iv"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/game-play-analysis-iv/">550.
游戏玩法分析 IV</a></h3>
<p>Table: <code>Activity</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">（player_id，event_date）是此表的主键（具有唯一值的列的组合）。</span><br><span class="line">这张表显示了某些游戏的玩家的活动情况。</span><br><span class="line">每一行是一个玩家的记录，他在某一天使用某个设备注销之前登录并玩了很多游戏（可能是 0）。</span><br></pre></td></tr></table></figure>
<p>编写解决方案，报告在首次登录的第二天再次登录的玩家的
<strong>比率</strong>，<strong>四舍五入到小数点后两位</strong>。换句话说，你需要计算从首次登录日期开始至少连续两天登录的玩家的数量，然后除以玩家总数。</p>
<p>结果格式如下所示：</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-03-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+-----------+</span><br><span class="line">| fraction  |</span><br><span class="line">+-----------+</span><br><span class="line">| 0.33      |</span><br><span class="line">+-----------+</span><br><span class="line">解释：</span><br><span class="line">只有 ID 为 1 的玩家在第一天登录后才重新登录，所以答案是 1/3 = 0.33</span><br></pre></td></tr></table></figure>
<h4 id="思路-14">思路</h4>
<h5 id="连接子查询-聚合">连接子查询 + 聚合</h5>
<p>先查出来用户的第一次登录记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(event_date) <span class="keyword">as</span> minDay, player_id</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> player_id</span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> minDay     <span class="operator">|</span> player_id <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="comment">---------- | --------- |</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2016</span><span class="number">-03</span><span class="number">-01</span> <span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2017</span><span class="number">-06</span><span class="number">-25</span> <span class="operator">|</span> <span class="number">2</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2016</span><span class="number">-03</span><span class="number">-02</span> <span class="operator">|</span> <span class="number">3</span>         <span class="operator">|</span></span><br></pre></td></tr></table></figure>
<p>然后与Activity本表连接：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.player_id</span><br><span class="line"><span class="keyword">from</span> Activity a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">min</span>(event_date) <span class="keyword">as</span> minDay, player_id</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> player_id) <span class="keyword">as</span> t1 <span class="keyword">on</span> a.player_id <span class="operator">=</span> t1.player_id</span><br><span class="line"><span class="keyword">where</span> a.event_date <span class="operator">=</span> ADDDATE(minDay, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> player_id <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="comment">--------- |</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>         <span class="operator">|</span></span><br></pre></td></tr></table></figure>
<p>最终sql：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> IFNULL(Round(<span class="built_in">count</span>(<span class="keyword">distinct</span>(result.player_id)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> Activity.player_id), <span class="number">2</span>), <span class="number">0</span>) <span class="keyword">as</span> fraction</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(<span class="keyword">select</span> a.player_id</span><br><span class="line"><span class="keyword">from</span> Activity a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">min</span>(event_date) <span class="keyword">as</span> minDay, player_id</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> player_id) <span class="keyword">as</span> t1 <span class="keyword">on</span> a.player_id <span class="operator">=</span> t1.player_id</span><br><span class="line"><span class="keyword">where</span> a.event_date <span class="operator">=</span> ADDDATE(minDay, <span class="number">1</span>) ) </span><br><span class="line"><span class="keyword">as</span> <span class="keyword">result</span> , Activity</span><br></pre></td></tr></table></figure>
<h1 id="排序和分组">排序和分组</h1>
<h2 id="简单-3">简单</h2>
<h3 id="每位教师所教授的科目种类的数量"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/number-of-unique-subjects-taught-by-each-teacher/">2356.
每位教师所教授的科目种类的数量</a></h3>
<p>表: <code>Teacher</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| teacher_id  | int  |</span><br><span class="line">| subject_id  | int  |</span><br><span class="line">| dept_id     | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">在 SQL 中，(subject_id, dept_id) 是该表的主键。</span><br><span class="line">该表中的每一行都表示带有 teacher_id 的教师在系 dept_id 中教授科目 subject_id。</span><br></pre></td></tr></table></figure>
<p>查询每位老师在大学里教授的科目种类的数量。</p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>查询结果格式示例如下。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">输入: </span><br><span class="line">Teacher 表:</span><br><span class="line">+------------+------------+---------+</span><br><span class="line">| teacher_id | subject_id | dept_id |</span><br><span class="line">+------------+------------+---------+</span><br><span class="line">| 1          | 2          | 3       |</span><br><span class="line">| 1          | 2          | 4       |</span><br><span class="line">| 1          | 3          | 3       |</span><br><span class="line">| 2          | 1          | 1       |</span><br><span class="line">| 2          | 2          | 1       |</span><br><span class="line">| 2          | 3          | 1       |</span><br><span class="line">| 2          | 4          | 1       |</span><br><span class="line">+------------+------------+---------+</span><br><span class="line">输出:  </span><br><span class="line">+------------+-----+</span><br><span class="line">| teacher_id | cnt |</span><br><span class="line">+------------+-----+</span><br><span class="line">| 1          | 2   |</span><br><span class="line">| 2          | 4   |</span><br><span class="line">+------------+-----+</span><br><span class="line">解释: </span><br><span class="line">教师 1:</span><br><span class="line">  - 他在 3、4 系教科目 2。</span><br><span class="line">  - 他在 3 系教科目 3。</span><br><span class="line">教师 2:</span><br><span class="line">  - 他在 1 系教科目 1。</span><br><span class="line">  - 他在 1 系教科目 2。</span><br><span class="line">  - 他在 1 系教科目 3。</span><br><span class="line">  - 他在 1 系教科目 4。</span><br></pre></td></tr></table></figure>
<h4 id="思路-15">思路</h4>
<h5 id="count-distinct">count + distinct</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> teacher_id, <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> subject_id) <span class="keyword">as</span> cnt</span><br><span class="line"><span class="keyword">from</span> Teacher </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> teacher_id</span><br></pre></td></tr></table></figure>
<h3 id="销售分析iii"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/sales-analysis-iii/">1084.
销售分析III</a></h3>
<p>表： <code>Product</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| unit_price   | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id 是该表的主键（具有唯一值的列）。</span><br><span class="line">该表的每一行显示每个产品的名称和价格。</span><br></pre></td></tr></table></figure>
<p>表：<code>Sales</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| seller_id   | int     |</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| buyer_id    | int     |</span><br><span class="line">| sale_date   | date    |</span><br><span class="line">| quantity    | int     |</span><br><span class="line">| price       | int     |</span><br><span class="line">+------ ------+---------+</span><br><span class="line">这个表可能有重复的行。</span><br><span class="line">product_id 是 Product 表的外键（reference 列）。</span><br><span class="line">该表的每一行包含关于一个销售的一些信息。</span><br></pre></td></tr></table></figure>
<p>编写解决方案，报告<code>2019年春季</code>才售出的产品。即<strong>仅</strong>在<code>2019-01-01</code>至<code>2019-03-31</code>（含）之间出售的商品。</p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>结果格式如下所示。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Product table:</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| product_id | product_name | unit_price |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| 1          | S8           | 1000       |</span><br><span class="line">| 2          | G4           | 800        |</span><br><span class="line">| 3          | iPhone       | 1400       |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">Sales table:</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| seller_id | product_id | buyer_id | sale_date  | quantity | price |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| 1         | 1          | 1        | 2019-01-21 | 2        | 2000  |</span><br><span class="line">| 1         | 2          | 2        | 2019-02-17 | 1        | 800   |</span><br><span class="line">| 2         | 2          | 3        | 2019-06-02 | 1        | 800   |</span><br><span class="line">| 3         | 3          | 4        | 2019-05-13 | 2        | 2800  |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">输出：</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| product_id  | product_name |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | S8           |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">解释:</span><br><span class="line">id 为 1 的产品仅在 2019 年春季销售。</span><br><span class="line">id 为 2 的产品在 2019 年春季销售，但也在 2019 年春季之后销售。</span><br><span class="line">id 为 3 的产品在 2019 年春季之后销售。</span><br><span class="line">我们只返回 id 为 1 的产品，因为它是 2019 年春季才销售的产品。</span><br></pre></td></tr></table></figure>
<h4 id="思路-16">思路</h4>
<h5 id="连接-not-in子查询">连接 + not in子查询</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  p. product_id, p.product_name </span><br><span class="line"><span class="keyword">from</span> Product p </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Sales s <span class="keyword">on</span> p.product_id <span class="operator">=</span> s.product_id</span><br><span class="line"><span class="keyword">where</span> sale_date <span class="keyword">between</span> <span class="string">&#x27;2019-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2019-03-31&#x27;</span></span><br><span class="line"><span class="keyword">and</span> p.product_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> s.product_id <span class="keyword">from</span> Sales s <span class="keyword">where</span> sale_date <span class="operator">&gt;</span> <span class="string">&#x27;2019-03-31&#x27;</span> <span class="keyword">or</span> sale_date <span class="operator">&lt;</span> <span class="string">&#x27;2019-01-01&#x27;</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> p. product_id</span><br></pre></td></tr></table></figure>
<h5 id="聚合函数-1">聚合函数</h5>
<p>独特的思路：既然要求<strong>仅</strong>在<code>2019-01-01</code>至<code>2019-03-31</code>之间出售的商品，等价为，在这个区间内，商品出售的数量和总共出售的数量相同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p. product_id, p.product_name </span><br><span class="line"><span class="keyword">from</span> Product p </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Sales s <span class="keyword">on</span> p.product_id <span class="operator">=</span> s.product_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> p. product_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(sale_date <span class="keyword">between</span> <span class="string">&#x27;2019-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2019-03-31&#x27;</span> <span class="keyword">or</span> <span class="keyword">null</span>) <span class="operator">=</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br></pre></td></tr></table></figure>
<h3 id="只出现一次的最大数字"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/biggest-single-number/">619.
只出现一次的最大数字</a></h3>
<p><code>MyNumbers</code> 表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| num         | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">该表可能包含重复项（换句话说，在SQL中，该表没有主键）。</span><br><span class="line">这张表的每一行都含有一个整数。</span><br></pre></td></tr></table></figure>
<p><strong>单一数字</strong> 是在 <code>MyNumbers</code>
表中只出现一次的数字。</p>
<p>找出最大的 <strong>单一数字</strong> 。如果不存在
<strong>单一数字</strong> ，则返回 <code>null</code> 。</p>
<p>查询结果如下例所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">MyNumbers 表：</span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">| 8   |</span><br><span class="line">| 8   |</span><br><span class="line">| 3   |</span><br><span class="line">| 3   |</span><br><span class="line">| 1   |</span><br><span class="line">| 4   |</span><br><span class="line">| 5   |</span><br><span class="line">| 6   |</span><br><span class="line">+-----+</span><br><span class="line">输出：</span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">| 6   |</span><br><span class="line">+-----+</span><br><span class="line">解释：单一数字有 1、4、5 和 6 。</span><br><span class="line">6 是最大的单一数字，返回 6 。</span><br></pre></td></tr></table></figure>
<p><strong>示例 2：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">MyNumbers table:</span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">| 8   |</span><br><span class="line">| 8   |</span><br><span class="line">| 7   |</span><br><span class="line">| 7   |</span><br><span class="line">| 3   |</span><br><span class="line">| 3   |</span><br><span class="line">| 3   |</span><br><span class="line">+-----+</span><br><span class="line">输出：</span><br><span class="line">+------+</span><br><span class="line">| num  |</span><br><span class="line">+------+</span><br><span class="line">| null |</span><br><span class="line">+------+</span><br><span class="line">解释：输入的表中不存在单一数字，所以返回 null 。</span><br></pre></td></tr></table></figure>
<h4 id="思路-17">思路</h4>
<h5 id="子查询">子查询</h5>
<p>先查单一数字，再从子表查出最大的那个。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(ch.num) <span class="keyword">as</span> num  <span class="keyword">from</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> MyNumbers </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> num</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">=</span> <span class="number">1</span>) <span class="keyword">as</span> ch</span><br></pre></td></tr></table></figure>
<h1 id="查询和连接">查询和连接</h1>
<h2 id="简单-4">简单</h2>
<h3 id="每位经理的下属员工数量"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/the-number-of-employees-which-report-to-each-employee/">1731.
每位经理的下属员工数量</a></h3>
<p>Table: <code>Employees</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-------------+----------+</span><br><span class="line">| Column Name | Type     |</span><br><span class="line">+-------------+----------+</span><br><span class="line">| employee_id | int      |</span><br><span class="line">| name        | varchar  |</span><br><span class="line">| reports_to  | int      |</span><br><span class="line">| age         | int      |</span><br><span class="line">+-------------+----------+</span><br><span class="line">employee_id 是这个表的主键.</span><br><span class="line">该表包含员工以及需要听取他们汇报的上级经理的ID的信息。 有些员工不需要向任何人汇报（reports_to 为空）。</span><br></pre></td></tr></table></figure>
<p>对于此问题，我们将至少有一个其他员工需要向他汇报的员工，视为一个经理。</p>
<p>编写SQL查询需要听取汇报的所有经理的ID、名称、直接向该经理汇报的员工人数，以及这些员工的平均年龄，其中该平均年龄需要四舍五入到最接近的整数。</p>
<p>返回的结果集需要按照 <code>employee_id</code>进行排序。</p>
<p>查询结果的格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Employees table:</span><br><span class="line">+-------------+---------+------------+-----+</span><br><span class="line">| employee_id | name    | reports_to | age |</span><br><span class="line">+-------------+---------+------------+-----+</span><br><span class="line">| 9           | Hercy   | null       | 43  |</span><br><span class="line">| 6           | Alice   | 9          | 41  |</span><br><span class="line">| 4           | Bob     | 9          | 36  |</span><br><span class="line">| 2           | Winston | null       | 37  |</span><br><span class="line">+-------------+---------+------------+-----+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+-------+---------------+-------------+</span><br><span class="line">| employee_id | name  | reports_count | average_age |</span><br><span class="line">+-------------+-------+---------------+-------------+</span><br><span class="line">| 9           | Hercy | 2             | 39          |</span><br><span class="line">+-------------+-------+---------------+-------------+</span><br><span class="line">Hercy 有两个需要向他汇报的员工, 他们是 Alice and Bob. 他们的平均年龄是 (41+36)/2 = 38.5, 四舍五入的结果是 39.</span><br></pre></td></tr></table></figure>
<h4 id="算法分析">算法分析</h4>
<h5 id="自身连接">自身连接</h5>
<p>以自己跟自己连接，a表查经理，b表查员工，连接结果如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> Employees a</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Employees b <span class="keyword">on</span> a.employee_id <span class="operator">=</span> b.reports_to</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> employee_id <span class="operator">|</span> name  <span class="operator">|</span> reports_to <span class="operator">|</span> age <span class="operator">|</span> employee_id <span class="operator">|</span> name  <span class="operator">|</span> reports_to <span class="operator">|</span> age <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="comment">----------- | ----- | ---------- | --- | ----------- | ----- | ---------- | --- |</span></span><br><span class="line"><span class="operator">|</span> <span class="number">9</span>           <span class="operator">|</span> Hercy <span class="operator">|</span> <span class="keyword">null</span>       <span class="operator">|</span> <span class="number">43</span>  <span class="operator">|</span> <span class="number">6</span>           <span class="operator">|</span> Alice <span class="operator">|</span> <span class="number">9</span>          <span class="operator">|</span> <span class="number">41</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">9</span>           <span class="operator">|</span> Hercy <span class="operator">|</span> <span class="keyword">null</span>       <span class="operator">|</span> <span class="number">43</span>  <span class="operator">|</span> <span class="number">4</span>           <span class="operator">|</span> Bob   <span class="operator">|</span> <span class="number">9</span>          <span class="operator">|</span> <span class="number">36</span>  <span class="operator">|</span></span><br></pre></td></tr></table></figure>
<ul>
<li>采用内连接避免空值</li>
</ul>
<p>这时候左半部分只需查<code>employee_id</code>、<code>name</code>即可，右边计算一下count，把age平均计算一下即可</p>
<p>总体sql语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.employee_id, a.name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> reports_count, ROUND(<span class="built_in">avg</span>(b.age)) <span class="keyword">as</span> average_age</span><br><span class="line"><span class="keyword">from</span> Employees a</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Employees b <span class="keyword">on</span> a.employee_id <span class="operator">=</span> b.reports_to</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.employee_id, a.name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.employee_id</span><br></pre></td></tr></table></figure>
<h3 id="员工的直属部门"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/primary-department-for-each-employee/">1789.
员工的直属部门</a></h3>
<p>表：<code>Employee</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   |  Type   |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| employee_id   | int     |</span><br><span class="line">| department_id | int     |</span><br><span class="line">| primary_flag  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">这张表的主键为 employee_id, department_id (具有唯一值的列的组合)</span><br><span class="line">employee_id 是员工的ID</span><br><span class="line">department_id 是部门的ID，表示员工与该部门有关系</span><br><span class="line">primary_flag 是一个枚举类型，值分别为(&#x27;Y&#x27;, &#x27;N&#x27;). 如果值为&#x27;Y&#x27;,表示该部门是员工的直属部门。 如果值是&#x27;N&#x27;,则否</span><br></pre></td></tr></table></figure>
<p>一个员工可以属于多个部门。当一个员工加入<strong>超过一个部门</strong>的时候，他需要决定哪个部门是他的直属部门。请注意，当员工只加入一个部门的时候，那这个部门将默认为他的直属部门，虽然表记录的值为<code>'N'</code>.</p>
<p>请编写解决方案，查出员工所属的直属部门。</p>
<p>返回结果 <strong>没有顺序要求</strong> 。</p>
<p>返回结果格式如下例子所示：</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Employee table:</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">| employee_id | department_id | primary_flag |</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">| 1           | 1             | N            |</span><br><span class="line">| 2           | 1             | Y            |</span><br><span class="line">| 2           | 2             | N            |</span><br><span class="line">| 3           | 3             | N            |</span><br><span class="line">| 4           | 2             | N            |</span><br><span class="line">| 4           | 3             | Y            |</span><br><span class="line">| 4           | 4             | N            |</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| employee_id | department_id |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 1             |</span><br><span class="line">| 2           | 1             |</span><br><span class="line">| 3           | 3             |</span><br><span class="line">| 4           | 3             |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">解释：</span><br><span class="line">- 员工 1 的直属部门是 1</span><br><span class="line">- 员工 2 的直属部门是 1</span><br><span class="line">- 员工 3 的直属部门是 3</span><br><span class="line">- 员工 4 的直属部门是 3</span><br></pre></td></tr></table></figure>
<h4 id="思路-18">思路</h4>
<p>本题的条件有两个</p>
<p>primary_flag='Y'的情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.employee_id, a.department_id</span><br><span class="line"><span class="keyword">from</span> Employee a</span><br><span class="line"><span class="keyword">where</span> a.primary_flag <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> employee_id <span class="operator">|</span> department_id <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="comment">----------- | ------------- |</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>           <span class="operator">|</span> <span class="number">1</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>           <span class="operator">|</span> <span class="number">3</span>             <span class="operator">|</span></span><br></pre></td></tr></table></figure>
<p>只有一个部门的情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.employee_id, a.department_id</span><br><span class="line"><span class="keyword">from</span> Employee a</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.employee_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(department_id) <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>这里count聚合函数，要放到having里执行，而不能用在where里了，因为select的字段不能包含count函数了，而分组后再进行聚合操作是可以的</li>
</ul>
<p>整体代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.employee_id, a.department_id</span><br><span class="line"><span class="keyword">from</span> Employee a</span><br><span class="line"><span class="keyword">where</span> a.primary_flag <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> a.employee_id, a.department_id</span><br><span class="line"><span class="keyword">from</span> Employee a</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.employee_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(department_id) <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>union也能去重</li>
</ul>
<h3 id="上升的温度"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/rising-temperature/">197.
上升的温度</a></h3>
<p>表： <code>Weather</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| recordDate    | date    |</span><br><span class="line">| temperature   | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id 是该表具有唯一值的列。</span><br><span class="line">没有具有相同 recordDate 的不同行。</span><br><span class="line">该表包含特定日期的温度信息</span><br></pre></td></tr></table></figure>
<p>编写解决方案，找出与之前（昨天的）日期相比温度更高的所有日期的
<code>id</code> 。</p>
<p>返回结果 <strong>无顺序要求</strong> 。</p>
<p>结果格式如下例子所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Weather 表：</span><br><span class="line">+----+------------+-------------+</span><br><span class="line">| id | recordDate | Temperature |</span><br><span class="line">+----+------------+-------------+</span><br><span class="line">| 1  | 2015-01-01 | 10          |</span><br><span class="line">| 2  | 2015-01-02 | 25          |</span><br><span class="line">| 3  | 2015-01-03 | 20          |</span><br><span class="line">| 4  | 2015-01-04 | 30          |</span><br><span class="line">+----+------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">| 2  |</span><br><span class="line">| 4  |</span><br><span class="line">+----+</span><br><span class="line">解释：</span><br><span class="line">2015-01-02 的温度比前一天高（10 -&gt; 25）</span><br><span class="line">2015-01-04 的温度比前一天高（20 -&gt; 30）</span><br></pre></td></tr></table></figure>
<h4 id="思路-19">思路</h4>
<h5 id="自我连接">自我连接</h5>
<p>连接的条件：比自身大一天的温度信息与自我连接，语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> Weather w1</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Weather w2 <span class="keyword">on</span> SUBDATE(w2.recordDate, <span class="number">1</span>) <span class="operator">=</span> w1.recordDate</span><br></pre></td></tr></table></figure>
<p>得到结果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">|</span> id <span class="operator">|</span> recordDate <span class="operator">|</span> temperature <span class="operator">|</span> id <span class="operator">|</span> recordDate <span class="operator">|</span> temperature <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="comment">-- | ---------- | ----------- | -- | ---------- | ----------- |</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> <span class="number">2015</span><span class="number">-01</span><span class="number">-01</span> <span class="operator">|</span> <span class="number">10</span>          <span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> <span class="number">2015</span><span class="number">-01</span><span class="number">-02</span> <span class="operator">|</span> <span class="number">25</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> <span class="number">2015</span><span class="number">-01</span><span class="number">-02</span> <span class="operator">|</span> <span class="number">25</span>          <span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> <span class="number">2015</span><span class="number">-01</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">20</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> <span class="number">2015</span><span class="number">-01</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">20</span>          <span class="operator">|</span> <span class="number">4</span>  <span class="operator">|</span> <span class="number">2015</span><span class="number">-01</span><span class="number">-04</span> <span class="operator">|</span> <span class="number">30</span>          <span class="operator">|</span></span><br></pre></td></tr></table></figure>
<p>随后添加一层判断结果即可，总的sql如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> w2.id</span><br><span class="line"><span class="keyword">from</span> Weather w1</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Weather w2 <span class="keyword">on</span> SUBDATE(w2.recordDate, <span class="number">1</span>) <span class="operator">=</span> w1.recordDate</span><br><span class="line"><span class="keyword">where</span> w1.temperature <span class="operator">&lt;</span> w2.temperature</span><br></pre></td></tr></table></figure>
<h3 id="员工奖金"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/employee-bonus/">577.
员工奖金</a></h3>
<p>表：<code>Employee</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| empId       | int     |</span><br><span class="line">| name        | varchar |</span><br><span class="line">| supervisor  | int     |</span><br><span class="line">| salary      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">empId 是该表中具有唯一值的列。</span><br><span class="line">该表的每一行都表示员工的姓名和 id，以及他们的工资和经理的 id。</span><br></pre></td></tr></table></figure>
<p>表：<code>Bonus</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| empId       | int  |</span><br><span class="line">| bonus       | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">empId 是该表具有唯一值的列。</span><br><span class="line">empId 是 Employee 表中 empId 的外键(reference 列)。</span><br><span class="line">该表的每一行都包含一个员工的 id 和他们各自的奖金。</span><br></pre></td></tr></table></figure>
<p>编写解决方案，报告每个奖金 <strong>少于</strong> <code>1000</code>
的员工的姓名和奖金数额。</p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>结果格式如下所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Employee table:</span><br><span class="line">+-------+--------+------------+--------+</span><br><span class="line">| empId | name   | supervisor | salary |</span><br><span class="line">+-------+--------+------------+--------+</span><br><span class="line">| 3     | Brad   | null       | 4000   |</span><br><span class="line">| 1     | John   | 3          | 1000   |</span><br><span class="line">| 2     | Dan    | 3          | 2000   |</span><br><span class="line">| 4     | Thomas | 3          | 4000   |</span><br><span class="line">+-------+--------+------------+--------+</span><br><span class="line">Bonus table:</span><br><span class="line">+-------+-------+</span><br><span class="line">| empId | bonus |</span><br><span class="line">+-------+-------+</span><br><span class="line">| 2     | 500   |</span><br><span class="line">| 4     | 2000  |</span><br><span class="line">+-------+-------+</span><br><span class="line">输出：</span><br><span class="line">+------+-------+</span><br><span class="line">| name | bonus |</span><br><span class="line">+------+-------+</span><br><span class="line">| Brad | null  |</span><br><span class="line">| John | null  |</span><br><span class="line">| Dan  | 500   |</span><br><span class="line">+------+-------+</span><br></pre></td></tr></table></figure>
<h4 id="思路-20">思路</h4>
<h5 id="or">or</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.name, b.bonus</span><br><span class="line"><span class="keyword">from</span> Employee e</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Bonus b <span class="keyword">on</span> e.empId <span class="operator">=</span> b.empId</span><br><span class="line"><span class="keyword">where</span> b.bonus <span class="keyword">is</span> <span class="keyword">null</span>  <span class="keyword">or</span> b.bonus <span class="operator">&lt;</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure>
<h5 id="union-all">union all</h5>
<p>会出现重复的name或者bonus，union会去重，选择union all</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.name, b.bonus</span><br><span class="line"><span class="keyword">from</span> Employee e</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Bonus b <span class="keyword">on</span> e.empId <span class="operator">=</span> b.empId</span><br><span class="line"><span class="keyword">where</span> b.bonus <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> e.name, b.bonus</span><br><span class="line"><span class="keyword">from</span> Employee e</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Bonus b <span class="keyword">on</span> e.empId <span class="operator">=</span> b.empId</span><br><span class="line"><span class="keyword">where</span>  b.bonus <span class="operator">&lt;</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure>
<h2 id="中等-1">中等</h2>
<h3 id="至少有5名直接下属的经理"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/managers-with-at-least-5-direct-reports/">570.
至少有5名直接下属的经理</a></h3>
<p>表: <code>Employee</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| name        | varchar |</span><br><span class="line">| department  | varchar |</span><br><span class="line">| managerId   | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">id 是此表的主键（具有唯一值的列）。</span><br><span class="line">该表的每一行表示雇员的名字、他们的部门和他们的经理的id。</span><br><span class="line">如果managerId为空，则该员工没有经理。</span><br><span class="line">没有员工会成为自己的管理者。</span><br></pre></td></tr></table></figure>
<p>编写一个解决方案，找出至少有<strong>五个直接下属</strong>的经理。</p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>查询结果格式如下所示。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">输入: </span><br><span class="line">Employee 表:</span><br><span class="line">+-----+-------+------------+-----------+</span><br><span class="line">| id  | name  | department | managerId |</span><br><span class="line">+-----+-------+------------+-----------+</span><br><span class="line">| 101 | John  | A          | Null      |</span><br><span class="line">| 102 | Dan   | A          | 101       |</span><br><span class="line">| 103 | James | A          | 101       |</span><br><span class="line">| 104 | Amy   | A          | 101       |</span><br><span class="line">| 105 | Anne  | A          | 101       |</span><br><span class="line">| 106 | Ron   | B          | 101       |</span><br><span class="line">+-----+-------+------------+-----------+</span><br><span class="line">输出: </span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| John |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>
<h4 id="思路-21">思路</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Employee <span class="operator">=</span></span><br><span class="line"><span class="operator">|</span> id  <span class="operator">|</span> name  <span class="operator">|</span> department <span class="operator">|</span> managerId <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="comment">--- | ----- | ---------- | --------- |</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span> <span class="operator">|</span> John  <span class="operator">|</span> A          <span class="operator">|</span> <span class="keyword">null</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span> <span class="operator">|</span> Dan   <span class="operator">|</span> A          <span class="operator">|</span> <span class="number">101</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span> <span class="operator">|</span> James <span class="operator">|</span> A          <span class="operator">|</span> <span class="number">101</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span> <span class="operator">|</span> Amy   <span class="operator">|</span> A          <span class="operator">|</span> <span class="number">101</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span> <span class="operator">|</span> Anne  <span class="operator">|</span> A          <span class="operator">|</span> <span class="number">101</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">106</span> <span class="operator">|</span> Ron   <span class="operator">|</span> B          <span class="operator">|</span> <span class="number">101</span>       <span class="operator">|</span></span><br></pre></td></tr></table></figure>
<p>自我连接：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> Employee e</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Employee e1 <span class="keyword">on</span> e.id <span class="operator">=</span> e1.managerId </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> id  <span class="operator">|</span> name <span class="operator">|</span> department <span class="operator">|</span> managerId <span class="operator">|</span> id  <span class="operator">|</span> name  <span class="operator">|</span> department <span class="operator">|</span> managerId <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="comment">--- | ---- | ---------- | --------- | --- | ----- | ---------- | --------- |</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span> <span class="operator">|</span> John <span class="operator">|</span> A          <span class="operator">|</span> <span class="keyword">null</span>      <span class="operator">|</span> <span class="number">102</span> <span class="operator">|</span> Dan   <span class="operator">|</span> A          <span class="operator">|</span> <span class="number">101</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span> <span class="operator">|</span> John <span class="operator">|</span> A          <span class="operator">|</span> <span class="keyword">null</span>      <span class="operator">|</span> <span class="number">103</span> <span class="operator">|</span> James <span class="operator">|</span> A          <span class="operator">|</span> <span class="number">101</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span> <span class="operator">|</span> John <span class="operator">|</span> A          <span class="operator">|</span> <span class="keyword">null</span>      <span class="operator">|</span> <span class="number">104</span> <span class="operator">|</span> Amy   <span class="operator">|</span> A          <span class="operator">|</span> <span class="number">101</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span> <span class="operator">|</span> John <span class="operator">|</span> A          <span class="operator">|</span> <span class="keyword">null</span>      <span class="operator">|</span> <span class="number">105</span> <span class="operator">|</span> Anne  <span class="operator">|</span> A          <span class="operator">|</span> <span class="number">101</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span> <span class="operator">|</span> John <span class="operator">|</span> A          <span class="operator">|</span> <span class="keyword">null</span>      <span class="operator">|</span> <span class="number">106</span> <span class="operator">|</span> Ron   <span class="operator">|</span> B          <span class="operator">|</span> <span class="number">101</span>       <span class="operator">|</span></span><br></pre></td></tr></table></figure>
<p>分组聚合：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.name</span><br><span class="line"><span class="keyword">from</span> Employee e</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Employee e1 <span class="keyword">on</span> e.id <span class="operator">=</span> e1.managerId </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(e.id) <span class="operator">&gt;=</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>
<h3 id="确认率"><a
target="_blank" rel="noopener" href="https://leetcode.cn/problems/confirmation-rate/">1934.
确认率</a></h3>
<p>表: <code>Signups</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------------+----------+</span><br><span class="line">| Column Name    | Type     |</span><br><span class="line">+----------------+----------+</span><br><span class="line">| user_id        | int      |</span><br><span class="line">| time_stamp     | datetime |</span><br><span class="line">+----------------+----------+</span><br><span class="line">User_id是该表的主键。</span><br><span class="line">每一行都包含ID为user_id的用户的注册时间信息。</span><br></pre></td></tr></table></figure>
<p>表: <code>Confirmations</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+----------------+----------+</span><br><span class="line">| Column Name    | Type     |</span><br><span class="line">+----------------+----------+</span><br><span class="line">| user_id        | int      |</span><br><span class="line">| time_stamp     | datetime |</span><br><span class="line">| action         | ENUM     |</span><br><span class="line">+----------------+----------+</span><br><span class="line">(user_id, time_stamp)是该表的主键。</span><br><span class="line">user_id是一个引用到注册表的外键。</span><br><span class="line">action是类型为(&#x27;confirmed&#x27;， &#x27;timeout&#x27;)的ENUM</span><br><span class="line">该表的每一行都表示ID为user_id的用户在time_stamp请求了一条确认消息，该确认消息要么被确认(&#x27;confirmed&#x27;)，要么被过期(&#x27;timeout&#x27;)。</span><br></pre></td></tr></table></figure>
<p>用户的 <strong>确认率</strong> 是 <code>'confirmed'</code>
消息的数量除以请求的确认消息的总数。没有请求任何确认消息的用户的确认率为
<code>0</code> 。确认率四舍五入到 <strong>小数点后两位</strong> 。</p>
<p>编写一个SQL查询来查找每个用户的 确认率 。</p>
<p>以 任意顺序 返回结果表。</p>
<p>查询结果格式如下所示。</p>
<p><strong>示例1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Signups 表:</span><br><span class="line">+---------+---------------------+</span><br><span class="line">| user_id | time_stamp          |</span><br><span class="line">+---------+---------------------+</span><br><span class="line">| 3       | 2020-03-21 10:16:13 |</span><br><span class="line">| 7       | 2020-01-04 13:57:59 |</span><br><span class="line">| 2       | 2020-07-29 23:09:44 |</span><br><span class="line">| 6       | 2020-12-09 10:39:37 |</span><br><span class="line">+---------+---------------------+</span><br><span class="line">Confirmations 表:</span><br><span class="line">+---------+---------------------+-----------+</span><br><span class="line">| user_id | time_stamp          | action    |</span><br><span class="line">+---------+---------------------+-----------+</span><br><span class="line">| 3       | 2021-01-06 03:30:46 | timeout   |</span><br><span class="line">| 3       | 2021-07-14 14:00:00 | timeout   |</span><br><span class="line">| 7       | 2021-06-12 11:57:29 | confirmed |</span><br><span class="line">| 7       | 2021-06-13 12:58:28 | confirmed |</span><br><span class="line">| 7       | 2021-06-14 13:59:27 | confirmed |</span><br><span class="line">| 2       | 2021-01-22 00:00:00 | confirmed |</span><br><span class="line">| 2       | 2021-02-28 23:59:59 | timeout   |</span><br><span class="line">+---------+---------------------+-----------+</span><br><span class="line">输出: </span><br><span class="line">+---------+-------------------+</span><br><span class="line">| user_id | confirmation_rate |</span><br><span class="line">+---------+-------------------+</span><br><span class="line">| 6       | 0.00              |</span><br><span class="line">| 3       | 0.00              |</span><br><span class="line">| 7       | 1.00              |</span><br><span class="line">| 2       | 0.50              |</span><br><span class="line">+---------+-------------------+</span><br><span class="line">解释:</span><br><span class="line">用户 6 没有请求任何确认消息。确认率为 0。</span><br><span class="line">用户 3 进行了 2 次请求，都超时了。确认率为 0。</span><br><span class="line">用户 7 提出了 3 个请求，所有请求都得到了确认。确认率为 1。</span><br><span class="line">用户 2 做了 2 个请求，其中一个被确认，另一个超时。确认率为 1 / 2 = 0.5。</span><br></pre></td></tr></table></figure>
<h4 id="思路-22">思路</h4>
<h5 id="count-if-1">count + if</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.user_id, IF(<span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">=</span> <span class="number">0</span>, <span class="number">0.00</span>, ROUND(<span class="built_in">count</span>(if(action <span class="operator">=</span> <span class="string">&#x27;confirmed&#x27;</span>, <span class="number">0</span>, <span class="keyword">NULL</span>)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>), <span class="number">2</span>)) <span class="keyword">as</span> confirmation_rate </span><br><span class="line"><span class="keyword">from</span> Signups s</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Confirmations c <span class="keyword">on</span> s.user_id <span class="operator">=</span> c.user_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.user_id</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://vlsmhd.github.io">Vlong_shen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://vlsmhd.github.io/2024/03/15/Leetcode-SQL%E4%B8%93%E9%A1%B9%E8%AE%AD%E7%BB%83/">https://vlsmhd.github.io/2024/03/15/Leetcode-SQL%E4%B8%93%E9%A1%B9%E8%AE%AD%E7%BB%83/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://vlsmhd.github.io" target="_blank">VLS_Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/03/19/%E9%AB%98%E6%80%A7%E8%83%BDIM%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" title="高性能IM即时通讯系统设计"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">高性能IM即时通讯系统设计</div></div></a></div><div class="next-post pull-right"><a href="/2024/03/13/WebSocket/" title="WebSocket"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">WebSocket</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Vlong_shen</div><div class="author-info__description">一名热爱编程的程序员</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">117</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">83</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/VLSmhd"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/VLSmhd" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/-" target="_blank" title="联系我QQ：1067853293"><i class="fab fa-qq"></i></a><a class="social-icon" href="/-" target="_blank" title="微信：18956757208"><i class="fa fa-wechat"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql%E5%B8%B8%E8%A7%81%E5%87%BD%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">Mysql常见函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.</span> <span class="toc-text">字符串函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.</span> <span class="toc-text">数值函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.</span> <span class="toc-text">日期函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%87%BD%E6%95%B0"><span class="toc-number">1.4.</span> <span class="toc-text">高级函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.</span> <span class="toc-text">简单查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95"><span class="toc-number">2.1.</span> <span class="toc-text">简单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%8F%E5%8F%B0%E6%9C%BA%E5%99%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%B9%B3%E5%9D%87%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">2.1.1.</span> <span class="toc-text">1661.
每台机器的进程平均运行时间</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8B%86%E5%88%86%E8%A1%A8"><span class="toc-number">2.1.1.1.1.</span> <span class="toc-text">拆分表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE%E7%94%A8%E6%88%B7%E6%8E%A8%E8%8D%90%E4%BA%BA"><span class="toc-number">2.1.2.</span> <span class="toc-text">584.
寻找用户推荐人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-1"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.1.2.1.1.</span> <span class="toc-text">多条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#in%E5%AD%90%E8%A1%A8"><span class="toc-number">2.1.2.1.2.</span> <span class="toc-text">in子表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#exists"><span class="toc-number">2.1.2.1.3.</span> <span class="toc-text">exists</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E7%9A%84%E5%9B%BD%E5%AE%B6"><span class="toc-number">2.1.3.</span> <span class="toc-text">595.
大的国家</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-2"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#or%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.1.3.1.1.</span> <span class="toc-text">or语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#union%E4%BC%98%E5%8C%96"><span class="toc-number">2.1.3.1.2.</span> <span class="toc-text">union优化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88-i"><span class="toc-number">2.1.4.</span> <span class="toc-text">1148. 文章浏览
I</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-3"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E6%95%88%E7%9A%84%E6%8E%A8%E6%96%87"><span class="toc-number">2.1.5.</span> <span class="toc-text">1683.
无效的推文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-4"><span class="toc-number">2.1.5.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B1%82%E9%95%BF%E5%BA%A6%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.5.1.1.</span> <span class="toc-text">求长度函数</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.</span> <span class="toc-text">连接查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95-1"><span class="toc-number">3.1.</span> <span class="toc-text">简单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86%E7%A0%81%E6%9B%BF%E6%8D%A2%E5%91%98%E5%B7%A5id"><span class="toc-number">3.1.1.</span> <span class="toc-text">1378.
使用唯一标识码替换员工ID</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-5"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#left-join"><span class="toc-number">3.1.1.1.1.</span> <span class="toc-text">left join</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90-i"><span class="toc-number">3.1.2.</span> <span class="toc-text">1068.
产品销售分析 I</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-6"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%BA%97%E5%8D%B4%E6%9C%AA%E8%BF%9B%E8%A1%8C%E8%BF%87%E4%BA%A4%E6%98%93%E7%9A%84%E9%A1%BE%E5%AE%A2"><span class="toc-number">3.1.3.</span> <span class="toc-text">1581.
进店却未进行过交易的顾客</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-7"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.1.3.1.1.</span> <span class="toc-text">连接表查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A6%E7%94%9F%E4%BB%AC%E5%8F%82%E5%8A%A0%E5%90%84%E7%A7%91%E6%B5%8B%E8%AF%95%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="toc-number">3.1.4.</span> <span class="toc-text">1280.
学生们参加各科测试的次数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-8"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E7%BA%A7%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.1.4.1.1.</span> <span class="toc-text">多级连接</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95-2"><span class="toc-number">4.1.</span> <span class="toc-text">简单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B3%E5%9D%87%E5%94%AE%E4%BB%B7"><span class="toc-number">4.1.1.</span> <span class="toc-text">1251.
平均售价</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-9"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-%E8%BF%9E%E8%A1%A8"><span class="toc-number">4.1.1.1.1.</span> <span class="toc-text">子查询 + 连表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E8%B5%9B%E4%BA%8B%E7%9A%84%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E7%8E%87"><span class="toc-number">4.1.2.</span> <span class="toc-text">1633.
各赛事的用户注册率</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-10"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5-%E8%81%9A%E5%90%88"><span class="toc-number">4.1.2.1.1.</span> <span class="toc-text">连接 + 聚合</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E7%9A%84%E8%B4%A8%E9%87%8F%E5%92%8C%E5%8D%A0%E6%AF%94"><span class="toc-number">4.1.3.</span> <span class="toc-text">1211.
查询结果的质量和占比</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-11"><span class="toc-number">4.1.3.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#count-if"><span class="toc-number">4.1.3.1.1.</span> <span class="toc-text">count + if</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E7%AD%89"><span class="toc-number">4.2.</span> <span class="toc-text">中等</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%8F%E6%9C%88%E4%BA%A4%E6%98%93-i"><span class="toc-number">4.2.1.</span> <span class="toc-text">1193.
每月交易 I</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-12"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.1.1.1.</span> <span class="toc-text">多聚合函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B3%E6%97%B6%E9%A3%9F%E7%89%A9%E9%85%8D%E9%80%81-ii"><span class="toc-number">4.2.2.</span> <span class="toc-text">1174.
即时食物配送 II</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-13"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#where%E5%AD%90%E6%9F%A5%E8%AF%A2-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.2.1.1.</span> <span class="toc-text">where子查询 + 聚合函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90-iv"><span class="toc-number">4.2.3.</span> <span class="toc-text">550.
游戏玩法分析 IV</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-14"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%AD%90%E6%9F%A5%E8%AF%A2-%E8%81%9A%E5%90%88"><span class="toc-number">4.2.3.1.1.</span> <span class="toc-text">连接子查询 + 聚合</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E5%92%8C%E5%88%86%E7%BB%84"><span class="toc-number">5.</span> <span class="toc-text">排序和分组</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95-3"><span class="toc-number">5.1.</span> <span class="toc-text">简单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%8F%E4%BD%8D%E6%95%99%E5%B8%88%E6%89%80%E6%95%99%E6%8E%88%E7%9A%84%E7%A7%91%E7%9B%AE%E7%A7%8D%E7%B1%BB%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">5.1.1.</span> <span class="toc-text">2356.
每位教师所教授的科目种类的数量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-15"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#count-distinct"><span class="toc-number">5.1.1.1.1.</span> <span class="toc-text">count + distinct</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90iii"><span class="toc-number">5.1.2.</span> <span class="toc-text">1084.
销售分析III</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-16"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5-not-in%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.1.2.1.1.</span> <span class="toc-text">连接 + not in子查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0-1"><span class="toc-number">5.1.2.1.2.</span> <span class="toc-text">聚合函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B0%E5%AD%97"><span class="toc-number">5.1.3.</span> <span class="toc-text">619.
只出现一次的最大数字</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-17"><span class="toc-number">5.1.3.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.1.3.1.1.</span> <span class="toc-text">子查询</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%92%8C%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.</span> <span class="toc-text">查询和连接</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95-4"><span class="toc-number">6.1.</span> <span class="toc-text">简单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%8F%E4%BD%8D%E7%BB%8F%E7%90%86%E7%9A%84%E4%B8%8B%E5%B1%9E%E5%91%98%E5%B7%A5%E6%95%B0%E9%87%8F"><span class="toc-number">6.1.1.</span> <span class="toc-text">1731.
每位经理的下属员工数量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">6.1.1.1.</span> <span class="toc-text">算法分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E8%BA%AB%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.1.1.1.1.</span> <span class="toc-text">自身连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%9A%84%E7%9B%B4%E5%B1%9E%E9%83%A8%E9%97%A8"><span class="toc-number">6.1.2.</span> <span class="toc-text">1789.
员工的直属部门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-18"><span class="toc-number">6.1.2.1.</span> <span class="toc-text">思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E5%8D%87%E7%9A%84%E6%B8%A9%E5%BA%A6"><span class="toc-number">6.1.3.</span> <span class="toc-text">197.
上升的温度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-19"><span class="toc-number">6.1.3.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E6%88%91%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.1.3.1.1.</span> <span class="toc-text">自我连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%A5%96%E9%87%91"><span class="toc-number">6.1.4.</span> <span class="toc-text">577.
员工奖金</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-20"><span class="toc-number">6.1.4.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#or"><span class="toc-number">6.1.4.1.1.</span> <span class="toc-text">or</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#union-all"><span class="toc-number">6.1.4.1.2.</span> <span class="toc-text">union all</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E7%AD%89-1"><span class="toc-number">6.2.</span> <span class="toc-text">中等</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%B3%E5%B0%91%E6%9C%895%E5%90%8D%E7%9B%B4%E6%8E%A5%E4%B8%8B%E5%B1%9E%E7%9A%84%E7%BB%8F%E7%90%86"><span class="toc-number">6.2.1.</span> <span class="toc-text">570.
至少有5名直接下属的经理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-21"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E7%8E%87"><span class="toc-number">6.2.2.</span> <span class="toc-text">1934.
确认率</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-22"><span class="toc-number">6.2.2.1.</span> <span class="toc-text">思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#count-if-1"><span class="toc-number">6.2.2.1.1.</span> <span class="toc-text">count + if</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/31/Spring%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="Spring深度学习">Spring深度学习</a><time datetime="2024-03-31T11:41:11.573Z" title="发表于 2024-03-31 19:41:11">2024-03-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/27/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%85%A5%E9%97%A8/" title="软件测试入门">软件测试入门</a><time datetime="2024-03-27T07:10:53.727Z" title="发表于 2024-03-27 15:10:53">2024-03-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/26/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" title="深入理解分布式系统-阅读笔记">深入理解分布式系统-阅读笔记</a><time datetime="2024-03-26T03:26:08.300Z" title="发表于 2024-03-26 11:26:08">2024-03-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/19/%E9%AB%98%E6%80%A7%E8%83%BDIM%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" title="高性能IM即时通讯系统设计">高性能IM即时通讯系统设计</a><time datetime="2024-03-19T13:31:13.565Z" title="发表于 2024-03-19 21:31:13">2024-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/15/Leetcode-SQL%E4%B8%93%E9%A1%B9%E8%AE%AD%E7%BB%83/" title="leetcode-SQL专项训练">leetcode-SQL专项训练</a><time datetime="2024-03-15T14:04:55.480Z" title="发表于 2024-03-15 22:04:55">2024-03-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Vlong_shen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>